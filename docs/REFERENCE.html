<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 6.0.4.1 (Linux)"/>
	<meta name="created" content="2018-04-16T21:23:38.583343612"/>
	<meta name="changed" content="2018-05-04T12:58:51.878424755"/>
	<style type="text/css">
		@page { margin: 2cm }
		p { margin-top: 0.1cm; margin-bottom: 0cm; line-height: 150%; orphans: 2; page-break-before: auto }
		p.western { font-size: 11pt }
		p.cjk { font-size: 10pt; font-weight: normal }
		h1 { margin-top: 1cm; line-height: 200%; text-align: center; page-break-before: auto }
		h1.western { font-family: "Bitstream Vera Sans", sans-serif; font-size: 20pt }
		h1.cjk { font-size: 10pt; font-weight: normal }
		h1.ctl { font-size: 12pt; font-weight: normal }
		h2 { margin-top: 0.8cm; margin-bottom: 0.4cm; line-height: 150%; text-align: center; page-break-before: auto }
		h2.western { font-family: "Bitstream Vera Sans", sans-serif }
		h2.cjk { font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal }
		h2.ctl { font-family: "Tahoma"; font-size: 12pt; font-weight: normal }
		h3 { margin-top: 0.6cm; margin-bottom: 0.3cm; line-height: 100%; page-break-before: auto; page-break-after: auto }
		h3.western { font-family: "Bitstream Vera Sans", sans-serif; font-size: 16pt; font-style: normal }
		h3.cjk { font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal }
		h3.ctl { font-family: "Tahoma"; font-size: 12pt; font-weight: normal }
		h4 { margin-top: 0.4cm; margin-bottom: 0.2cm; line-height: 150%; text-align: left; page-break-before: auto; page-break-after: auto }
		h4.western { font-family: "Bitstream Vera Sans", sans-serif; font-size: 14pt; font-style: normal }
		h4.cjk { font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal }
		h4.ctl { font-family: "Tahoma"; font-size: 12pt; font-weight: normal }
		pre { line-height: 150%; page-break-before: auto }
		pre.western { font-family: "Bitstream Vera Sans Mono", monospace; font-size: 11pt }
		pre.cjk { font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal }
		pre.ctl { font-family: "Tahoma"; font-size: 12pt }
		pre.php-western { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #001f3f; font-family: "Bitstream Vera Sans Mono", monospace; font-size: 9pt; font-style: normal; font-weight: normal; line-height: 100%; background: #dfdfdf; page-break-after: avoid }
		pre.php-cjk { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #001f3f; font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal; line-height: 100%; background: #dfdfdf; page-break-after: avoid }
		pre.php-ctl { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #001f3f; font-family: "Tahoma"; font-size: 12pt; line-height: 100%; background: #dfdfdf; page-break-after: avoid }
		pre.shell-western { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #000000; font-family: "Bitstream Vera Sans Mono", monospace; font-size: 9pt; line-height: 100%; background: #ffffef; page-break-after: auto }
		pre.shell-cjk { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #000000; font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal; line-height: 100%; background: #ffffef; page-break-after: auto }
		pre.shell-ctl { margin-left: 0.2cm; margin-right: 0.2cm; margin-top: 0.2cm; margin-bottom: 0.8cm; color: #000000; font-family: "Tahoma"; font-size: 12pt; line-height: 100%; background: #ffffef; page-break-after: auto }
		h5 { margin-top: 0.2cm; margin-bottom: 0.1cm; line-height: 150%; page-break-before: auto }
		h5.western { font-family: "Bitstream Vera Sans", sans-serif; font-size: 12pt; font-weight: normal }
		h5.cjk { font-family: "Lucida Sans Unicode"; font-size: 10pt; font-weight: normal }
		h5.ctl { font-family: "Tahoma"; font-size: 12pt; font-weight: normal }
		a.cjk:link { so-language: zxx }
		a.ctl:link { so-language: zxx }
		a.western:visited { so-language: en-GB }
	</style>
</head>
<body lang="en-GB" bgcolor="#efefef" dir="ltr">
<h1 class="western">SimpleESI</h1>
<h2 class="western">Reference Manual</h2>
<hr/>

<p class="western">This manual describes the class SimpleESI and is
divided into three sections. The first section describes the traits
that can be used together with the class and that are being provided
by the file <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">SimpleESI.php</span></font>.
The second section describes the member variables and the last
section describes the member methods of the class.</p>
<p class="western">The notation marks data types with <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">()</span></font>,
mandatory arguments are marked with <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">&lt;&gt;</span></font>
and optional arguments are marked with <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">[]</span></font>.
For example:</p>
<pre class="php-western">(type) variable
(type) method(&lt;(type) $mandatory&gt;, [(type) $optional])</pre>
<hr/>

<h3 class="western">1. Class Traits</h3>
<p class="western" style="orphans: 2">The file <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">SimpleESI.php</span></font>
contains several traits, which can be used for customizing the
SimpleESI class. The main purpose however is to trim down the class
further than its default, should this become necessary. There are
currently two groups of traits, one for the debug messages and one
for the database accesses. To choose a different trait does one need
to create a child class, which extends SimpleESI. For example:</p>
<pre class="php-western">class ESInodb extends SimpleESI { use nodb; }
class ESInodbg extends SimpleESI { use nodebug; }
class SlimESI extends SimpleESI { use nodebug, nodb; }</pre><h4 class="western">
1.1. Debugging Traits</h4>
<h5 class="western">1.1.1. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">nodebug</span></font></h5>
<p class="western" style="orphans: 2"><i>Provides no public variables
or methods.</i></p>
<p class="western" style="orphans: 2">The trait disables all
debugging output and will not throw any exceptions. It is useful for
when one does not want to know or care about any of the messages.</p>
<pre class="php-western">class MyESI extends SimpleESI { use nodebug; }
$esi = new MyESI;</pre><h5 class="western">
1.1.2. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">debug</span></font>
<b>(default)</b></h5>
<p class="western" style="orphans: 2"><i>Public variables:</i> <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
debug_level</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(bool)
debug_html</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
debug_file</span></font></p>
<p class="western" style="orphans: 2"><i>Provides no public methods.</i></p>
<p class="western" style="orphans: 2">Provides full debugging support
and throws exceptions on fatal errors. The level of detail can be
control with the variable <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;debug_level</span></font>,
and the higher the value is (i.e. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">4</span></font>)
the more information is printed. The output can be formatted as plain
text or as colourized HTML text, which is control by the variable
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;debug_html</span></font>,
where <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">true</span></font>
stands for HTML output and <span style="background: #dfdfdf">false</span>
for plain ASCII. For example:</p>
<pre class="php-western">$esi = new SimpleESI;
$esi-&gt;debug_level = 4;
$esi-&gt;debug_html = true;</pre><p class="western" style="orphans: 2">
The debug messages can be written into a file with the variable
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;debug_file</span></font>,
in which case the messages also show date and day time information.
For example:</p>
<pre class="php-western">$esi-&gt;debug_level = 2;
$esi-&gt;debug_file = 'esi.log';</pre><h5 class="western">
The following is a list of debug messages and their level:</h5>
<pre class="shell-western">-1, 'Could not create cache directory'
-1, 'Could not create cache subdirectory'
-1, 'Could not create meta directory'
-1, 'Could not create meta subdirectory'
-1, 'Could not write/update cache file'
-1, 'Could not write/update meta file'
-1, 'Error limit reached: X'
0, 'Authorization error: no character identification received.'
0, 'Authorization error: no tokens received.'
0, 'cURL error: X'
0, 'Error response: X'
0, 'No response: X'
0, 'Unexpected cURL result: X'
0, 'Unexpected response: X'
1, 'Elapsed.'
2, 'Error limit: X, window: Y'
2, 'Retry (# X): Y'
2, 'Throttling traffic.'
3, 'Authorization tokens received.'
3, 'Character identification received.'
3, 'Received: X'
3, 'Refreshing authorization.'
3, 'Requesting authorization.'
3, 'Requesting character identification.'
3, 'Requesting pages X to Y of: Z'
3, 'Requesting (POST): X'
3, 'Requesting: X'
4, 'Cached: X'
4, 'cURL option X is not supported.'
5, 'Header: X'</pre><h4 class="western">
1.2. Database Traits</h4>
<h5 class="western">1.2.1. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">nodb</span></font></h5>
<p class="western" style="orphans: 2"><i>Provides no public
variables.</i></p>
<p class="western" style="orphans: 2"><i>Public m</i><i>ethods:</i>
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(null)
meta(&lt;(string) $key&gt;, [(mixed) $value])</span></font></p>
<p class="western" style="orphans: 2">Disables all uses of a
database. No response caching is performed and no meta database is
being provided. The trait is useful for when no database is available
on the system, for a read-only filesystem, or for debugging and to
test how an application performs without any caching or database
access. Calls to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">meta()</span></font>-method
will not result in an error, but is only implemented as a stub. It
does not perform any function.</p>
<pre class="php-western">class MyESI extends SimpleESI { use nodb; }
$esi = new MyESI;</pre><h5 class="western">
1.2.2. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">dirdb</span></font></h5>
<p class="western" style="orphans: 2"><i>Public variables</i><i>:</i>
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(bool)
caching</span></font></p>
<p class="western" style="orphans: 2"><i>Public m</i><i>ethods:</i>
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(mixed)
meta(&lt;(string) $key&gt;, [(mixed) $value])</span></font></p>
<p class="western" style="orphans: 2">The trait implements a database
by using directories and files. The directory structure is similar to
the ESI resource paths. The filenames contain query arguments and end
with an identifier, which in case of authenticated requests is
identical to the character id and meant to keep cached responses of
authorized calls between different characters separate. A file's
modification time is used to store the expiration time of its
resource and therefore is set to a time in the future. The cache can
be controlled at runtime through the variable <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;caching</span></font>,
which allows an application to enable or disable it at will. Caching
is enabled by default.</p>
<pre class="php-western">class MyESI extends SimpleESI { use dirdb; }
$esi = new MyESI;
$esi-&gt;caching = false;</pre><p class="western" style="orphans: 2">
The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">meta()</span></font>-method
implements a “key/value”-database. When called with one argument,
a key, does it query the database for the value associated with the
key:</p>
<pre class="php-western">$value = $esi-&gt;meta('key');</pre><p class="western" style="orphans: 2">
The key has to be a string and represents a file on the drive, whose
content represents the value. The file's content is interpreted by
the PHP function <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">unserialize()</span></font>
and so can return any data type supported by it. When called with two
arguments, a key and a value, does it assign the value to the key by
storing the value in a file with the key as its name:</p>
<pre class="php-western">$esi-&gt;meta('key', $value);</pre><p class="western" style="orphans: 2">
The content of <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$value</span></font>
is turned into a string by the PHP function <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">serialize()</span></font>
before storing it. It allows to store different data types, including
self-referencing arrays and class objects. For more information
please see the PHP manual on <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">serialize()</span></font>/<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">unserialize()</span></font>.</p>
<p class="western" style="orphans: 2">Note: it is possible to use the
directory seperator <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">/</span></font>
as a part of a key, which will place the corresponding file into a
subdirectory. It also means both <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">..</span></font>
and <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">.</span></font>
work for changing directories as expected, and need to be avoided
when keys are meant to stay compatible to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">sqlite3db</span></font>-trait.</p>
<h5 class="western">1.2.3. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">sqlite3db</span></font>
<b>(default)</b></h5>
<p class="western" style="orphans: 2"><i>Public variables</i><i>:</i>
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(bool)
caching</span></font></p>
<p class="western" style="orphans: 2"><i>Public m</i><i>ethods:</i>
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(mixed)
meta(&lt;(string) $key&gt;, [(mixed) $value])</span></font></p>
<p class="western" style="orphans: 2">The trait implements a database
by using SQLite3, which consists of two SQL tables, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">cache</span></font>
and <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">meta</span></font>,
for caching responses and for providing a “key/value”-database.
When authorized requests are being cached are these stored together
with the character's id to keep responses between different users
separate. Caching can be controlled through the variable <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;caching</span></font>,
and by setting it to either <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">true</span></font>
or <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">false</span></font>
in order to enable and disable the mechanism at runtime. Caching is
enabled by default.</p>
<pre class="php-western">$esi = new SimpleESI;
$esi-&gt;caching = false;</pre><p class="western" style="orphans: 2">
The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">meta()</span></font>-method
implements a “key/value”-database analogue to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">dirdb</span></font>-trait
above. When called with one argument, a key, does it query the
database for the value associated with the key:</p>
<pre class="php-western">$value = $esi-&gt;meta('key');</pre><p class="western" style="orphans: 2">
The key has to be a string and represents a column in the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">meta</span></font>
table. The value is interpreted by the PHP function <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">unserialize()</span></font>
in the same way as it is done in the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">dirdb</span></font>-trait.
When called with two arguments, a key and a value, does it assign the
value to the key by storing both key and value in the SQL table:</p>
<pre class="php-western">$esi-&gt;meta('key', $value);</pre><p class="western" style="orphans: 2">
The content of <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$value</span></font>
is turned into a string by the PHP function <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">serialise()</span></font>
before storing it in the database.</p>
<p class="western" style="orphans: 2">Note: keys should not contain
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">..</span></font>
and <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">.</span></font>
when these are meant to be compatible with the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">dirdb</span></font>-trait.</p>
<hr/>

<h3 class="western">2. Class Variables</h3>
<h5 class="western">2.1. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
esi_uri</span></font></h5>
<p class="western" style="orphans: 2">The URI of the ESI server. Can
be changed when necessary and must end with a <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">/</span></font>-character.
The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">https://esi.evetech.net/latest/</span></font>.</p>
<pre class="php-western">$esi-&gt;esi_uri = 'https://esi.evetech.net/dev/';</pre><h5 class="western">
2.2. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
oauth_uri</span></font></h5>
<p class="western" style="orphans: 2">The URI of the SSO OAuth2
server. Can be changed when necessary and must end with a
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">/</span></font>-character.
The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">https://login.eveonline.com/oauth/</span></font>.</p>
<pre class="php-western">$esi-&gt;oauth_uri = 'https://sisilogin.testeveonline.com/oauth/';</pre><h5 class="western">
2.3. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
marker</span></font></h5>
<p class="western" style="orphans: 2">The character, or string, used
in a pattern to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">get()</span></font>-method.
The default is the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">~</span></font>-character.</p>
<pre class="php-western">$esi-&gt;marker = '#';</pre><h5 class="western">
2.4. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(bool)
paging</span></font></h5>
<p class="western" style="orphans: 2">A toggle to disable and enable
the behaviour of the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">exec()</span></font>-method
when responses are segmented into pages. The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">true</span></font>,
causing the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">exec()</span></font>-method
to request all pages automatically.</p>
<pre class="php-western">$esi-&gt;paging = false;</pre><h5 class="western">
2.5. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
retries</span></font></h5>
<p class="western" style="orphans: 2">The number of additional
attempts to make when requests fail. The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">3</span></font>.</p>
<pre class="php-western">$esi-&gt;retries = 6;</pre><h5 class="western">
2.6. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
error_throttle</span></font></h5>
<p class="western" style="orphans: 2">The number of errors remaining
(according to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">X-ESI-Error-Limit-Remain:</span></font>-header)
at which to begin throttling out-going traffic. The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">80</span></font>.
The ESI error limit is a number, starting at <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">100</span></font>,
which is returned by ESI for each request and represents a count-down
after which an application is denied access (for a limited time). It
is meant to control the traffic to the ESI server and to give each
application a chance to back off in cases where there is a problem.
The number is not necessarily an indication for an application error.
A count-down can occur for various reasons. The error count is valid
for a limited time after which it is reset to <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">100</span></font>.
SimpleESI uses a non-linear function to implement a dynamic
behaviour. When the reported error limit drops to or below the
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">-&gt;error_throttle</span></font>
value will it pause briefly for a few milliseconds before sending out
a new request. This pause will grow longer the closer the count-down
gets to <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">0</span></font>
and the larger the remaining time window is.</p>
<pre class="php-western">$esi-&gt;error_throttle = 90;</pre><h5 class="western">
2.7. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
error_exit</span></font></h5>
<p class="western" style="orphans: 2">The number of errors remaining
at which to raise an exception in the application. The default is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">20</span></font>.
If the exception is not caught will it exit the application. It is
meant to prevent the count-down from reaching <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">0</span></font>,
at which the ESI server will reject further requests. Setting this
value below <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">0</span></font>
will turn this behaviour off and offers a good chance for your
application to be noticed at CCP.</p>
<pre class="php-western">$esi-&gt;error_exit = -1;</pre>
<hr/>

<h3 class="western">3. Class Methods</h3>
<h5 class="western">3.1. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">__construct([(string)
$name], [(string) $useragent])</span></font></h5>
<p class="western" style="orphans: 2">The constructor can take up to
two arguments. The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$name</span></font>-argument
can be used to name the database, and the second argument <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$useragent</span></font>
can be used to set the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">X-User-Agent:</span></font>-header.
The default database name is <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'esi'</span></font>,
which in case of the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">sqlite3db</span></font>-trait
names the database file <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'esi.sq3'</span></font>,
and in case of the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">dirdb</span></font>-trait
names the top-level directory <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'esi.dir'</span></font>.
Examples are:</p>
<pre class="php-western">$esi = new SimpleESI;
$esi2 = new SimpleESI('esi2');
$myesi = new SimpleESI('myesi', 'My App 1.0');</pre><h5 class="western">
3.2. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">__destruct()</span></font></h5>
<p class="western" style="orphans: 2">The destructor prints a level 1
debug message to give information about the life span of the object.
For example:</p>
<pre class="shell-western">[SimpleESI] 000.009s 0b (1) Elapsed.</pre><h5 class="western">
3.3. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(object)
get(&lt;(mixed) &amp;$variable&gt;, &lt;...(mixed) $arguments&gt;)</span></font></h5>
<p class="western" style="orphans: 2">Alternative notation:</p>
<pre class="php-western">(object) get(&lt;(mixed) &amp;$variable&gt;,
             [(array) $values],
             &lt;(string) $request&gt;,
             [(array) $query],
             [(int) $expires],
             [(array) $authorization],
             [(callable) $callback])</pre><p class="western" style="orphans: 2">
The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">get()</span></font>-method
takes a variable number of arguments, and depending on the type of
arguments will it queue one or more requests. The first argument,
here named <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$variable</span></font>,
needs to be a variable and cannot be a value or an expression. A
reference to the variable is stored along with any requests and used
in assigning the response(s) to the variable during an execution by
the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">exec()</span></font>-method.
When the second argument to the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">get()</span></font>-method
is a string then it is taken as the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-string
and a single request will be queued. For example:</p>
<pre class="php-western">$esi-&gt;get($var, 'universe/types/1230/');</pre><p class="western" style="orphans: 2">
When instead of a string an array <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$values</span></font>
is being passed, then a third argument will be taken as the
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-pattern
and the values of the array <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$values</span></font>
will be used to create multiple requests by substituting these each
with the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">~</span></font>-character
in the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-pattern.
The responses are assigned as an array, where each value of the
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$values</span></font>-array
becomes the key to the corresponding response. For example:</p>
<pre class="php-western">$esi-&gt;get($var, [123, 456, 789], 'universe/types/~/');</pre><p class="western" style="orphans: 2">
This is equivalent to:</p>
<pre class="php-western">$esi-&gt;get($var[123], 'universe/types/123/')
    -&gt;get($var[456], 'universe/types/456/')
    -&gt;get($var[789], 'universe/types/789/');</pre><p class="western" style="orphans: 2; page-break-before: auto; page-break-after: auto">
When an associative array is being passed after the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-string
or -pattern, then it is used to form and append a query string to the
request(s). The elements of the associative <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$query</span></font>-array
are URL-encoded according to RFC3986, and in the case of a pattern
substitution is the query string be appended to the pattern and the
values of the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$value</span></font>-array
are URL-encoded before a substitution is being made. For example:</p>
<pre class="php-western">$esi-&gt;get($var1, 'universe/types/1230/', ['language' =&gt; 'de']);
$esi-&gt;get($var2, ['fr', 'ru'], 'universe/types/1230/', ['language' =&gt; '~']);
$esi-&gt;get($var3, 'search/?categories=region&amp;strict=1&amp;', ['search' =&gt; 'The Forge']);
$esi-&gt;get($var4, ['Domain', 'Sinq Laison'], 'search/?categories=region&amp;strict=1&amp;', ['search' =&gt; '~']);</pre><p class="western" style="orphans: 2">
This is equivalent to:</p>
<pre class="php-western">$esi-&gt;get($var1, 'universe/types/1230/?language=de');
$esi-&gt;get($var2['fr'], 'universe/types/1230/?language=fr')
    -&gt;get($var2['ru'], 'universe/types/1230/?language=ru');
$esi-&gt;get($var3, 'search/?categories=region&amp;strict=1&amp;search=The%20Forge');
$esi-&gt;get($var4['Domain'], 'search/?categories=region&amp;strict=1&amp;search=Domain')
    -&gt;get($var4['Sinq Laison'], 'search/?categories=region&amp;strict=1&amp;search=Sinq%20Laison');</pre><p class="western" style="orphans: 2; page-break-before: auto; page-break-after: auto">
When an integer <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$expires</span></font>
is being passed after the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-string,
or -pattern, or after the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$query</span></font>-array
then it is used as a time in seconds by which to offset a resource's
expiration time. A positive value extends an expiration time
temporarily, while a negative value shortens it. The value only
affects the cache lookup, but it does not alter the actual expiration
time of a resource. For example:</p>
<pre class="php-western">$esi-&gt;get($var1, 'universe/types/1230/', 60*60);
$esi-&gt;get($var2, [123, 456, 789], 'universe/types/~/', 60*60);
$esi-&gt;get($var3, ['fr', 'ru'], 'universe/types/1230/', ['language' =&gt; '~'], 60*60);</pre><p class="western" style="orphans: 2">
When the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$expires</span></font>
argument is being followed by an array, here named <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$authorization</span></font>,
then this array is taken as a request's authorization data.
Authorization data is usually obtained by the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">auth()</span></font>-method.
The array is expected to contain two keys, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'header'</span></font>
and <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'cid'</span></font>,
which hold the authorization header to be used in the request, as
well as the character id to be used in the cache lookup. For example:</p>
<pre class="php-western">$esi-&gt;get($var1, 'universe/types/1230/', 0, $authorization);
$esi-&gt;get($var2, [123, 456, 789], 'universe/types/~/', 0, $authorization);
$esi-&gt;get($var3, ['fr', 'ru'], 'universe/types/1230/', ['language' =&gt; '~'], 60*60, $authorization);</pre><p class="western" style="orphans: 2">
When a last argument <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$callback</span></font>
is being passed, and after the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$request</span></font>-string
or -pattern, which is neither of the type int or of the type array,
then it is taken as the name of a function or a callable closure that
is to be executed the moment a response arrives. For example:</p>
<pre class="php-western">$esi-&gt;get($var1, 'universe/types/1230/', 'callback1');
$esi-&gt;get($var2, [123, 456, 789], 'universe/types/~/', function($esi, $rq) { /* function body */ });
$esi-&gt;get($var3, ['fr', 'ru'], 'universe/types/1230/', ['language' =&gt; '~'], 60*60, $auth, 'callback2');</pre><h5 class="western">
Callback Functions</h5>
<p class="western" style="orphans: 2">Callback functions get two
arguments. The first argument is the executing SimpleESI object and
the second is an object containing a request's data:</p>
<pre class="php-western">(void) function callback($esi, $rq) { /* function body */ };</pre><p class="western" style="orphans: 2">
The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$esi</span></font>-object
can be used to queue new requests during an execution. The <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq</span></font>-object
holds the information about a request and its response. When a
request was queued with the <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">get()</span></font>-method
then this object has got the following member variables: <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
rq</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
ci</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
ex</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
lm</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(reference)
vl</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
pn</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
pi</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(string)
ah</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(callable)
cb</span></font>, <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(int)
rt</span></font></p>
<p class="western" style="orphans: 2"><font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;rq</span></font>
is the request string including query arguments. I.e.:
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'universe/types/1230/'</span></font>.
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;ci</span></font>
is the cache id used in separating cache responses for different
users. For unauthorized requests is this value <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">0</span></font>
and for authorized request is it the character's id. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;ex</span></font>
is the expiration time in seconds since 1970. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;lm</span></font>
is the “Last Modified”-time in seconds since 1970. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;vl</span></font>
is a reference to the variable that holds the response. In case of
multiple responses and paged responses is it a reference to the array
element itself. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;pn</span></font>
is the total number of pages of segmented responses, or <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">null</span></font>
when unsegmented. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;pi</span></font>
is the page index of a response when it was requested automatically,
starting at offset <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">1</span></font>
for page 2, and otherwise is it <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">null</span></font>.
<font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;ah</span></font>
is the authorization header used in a request, or <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">null</span></font>
for unauthorized requests. i.e.: <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">'Authorization:
Bearer ...'</span></font>. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">$rq-&gt;rt</span></font>
is the number of retries made in receiving the response.</p>
<p class="western" style="orphans: 2">A callback can either be the
name of a function:</p>
<pre class="php-western" style="font-style: normal">$Veldspar = null;

$esi-&gt;get($var, 'universe/types/1230/', 'callback')-&gt;exec();

function callback($esi, $rq) {
   global $Veldspar;
   <span style="font-style: normal">$Veldspar = $rq-&gt;vl</span><span style="font-style: normal">['description']</span><span style="font-style: normal">;</span>
   echo 'Last Modified: '.date('r', $rq-&gt;lm).PHP_EOL;
}</pre><p class="western" style="orphans: 2">
or a nameless function, also known as a closure:</p>
<pre class="php-western" style="font-style: normal">$Veldspar = null;

$esi-&gt;get($var, 'universe/types/1230/', function($esi, $rq) use ($Veldspar) {
    <span style="font-style: normal">$Veldspar = $rq-&gt;vl</span><span style="font-style: normal">['description']</span><span style="font-style: normal">;</span>
    echo 'Last Modified: '.date('r', $rq-&gt;lm).PHP_EOL;
})-&gt;exec();</pre><h5 class="western">
Paged Responses</h5>
<p class="western"><br/>

</p>
<h5 class="western">3.4. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(void)
single_get(&lt;(mixed) &amp;$variable&gt;, &lt;(string) $request&gt;,
[(int) $expires], [(int) $charid], [(string) $authheader],
[(callable) $callback])</span></font></h5>
<p class="western" style="orphans: 2"><br/>

</p>
<h5 class="western">3.5. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(object)
post(&lt;(mixed) &amp;$variable&gt;, &lt;(string) $request&gt;,
&lt;(mixed) $data&gt;, [(array) $authorization], [(callable)
$callback])</span></font></h5>
<p class="western" style="orphans: 2"><br/>

</p>
<h5 class="western">3.6. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(object)
exec()</span></font></h5>
<p class="western" style="orphans: 2"><br/>

</p>
<h5 class="western">3.7. <font face="Bitstream Vera Sans Mono, monospace"><span style="background: #dfdfdf">(bool)
auth(&lt;(array) &amp;$authorization&gt;, [(string) $code])</span></font></h5>
<p class="western" style="orphans: 2"><br/>

</p>
</body>
</html>